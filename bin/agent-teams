#!/usr/bin/env node

/**
 * Agent Teams Monitor CLI
 * ç”¨æ³•: agent-teams [å‘½ä»¤]
 */

import { spawn } from 'child_process';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const projectPath = __dirname;

const args = process.argv.slice(2);
const command = args[0] || 'start';

const commands = {
  start: 'npm run dev',
  server: 'npm run dev:server',
  client: 'npm run dev:client',
  build: 'npm run build',
  test: 'npm run test',
  help: null,
};

const runCommand = (cmd) => {
  const [script, ...scriptArgs] = cmd.split(' ');
  const child = spawn(script, scriptArgs, {
    cwd: projectPath,
    stdio: 'inherit',
    shell: true,
  });

  child.on('exit', (code) => {
    process.exit(code || 0);
  });
};

if (command === 'help' || !commands[command]) {
  console.log(`
ğŸ¤– Agent Teams Monitor CLI

ç”¨æ³•: agent-teams [å‘½ä»¤]

å‘½ä»¤:
  start       å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (å‰ç«¯ + åç«¯) [é»˜è®¤]
  server      ä»…å¯åŠ¨åç«¯æœåŠ¡å™¨
  client      ä»…å¯åŠ¨å‰ç«¯
  build       æ„å»ºç”Ÿäº§ç‰ˆæœ¬
  test        è¿è¡Œæµ‹è¯•
  help        æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

ç¤ºä¾‹:
  agent-teams          å¯åŠ¨æœåŠ¡
  agent-teams server   ä»…å¯åŠ¨åç«¯
  agent-teams help     æŸ¥çœ‹å¸®åŠ©
`);
} else {
  runCommand(commands[command]);
}
